@model List<CartItem>

@{
    ViewData["Title"] = "Your Cart";
    decimal grandTotal = Model.Sum(item => item.Price * item.Quantity);
}

<link rel="stylesheet" href="~/css/CartIndex.css" />

<div class="layout">
    <!-- Sidebar / Navbar -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <img src="~/img/cityboneslogo.jpeg" alt="CityBones Logo" />
        </div>
        <ul>
            <li><a asp-controller="Home" asp-action="Index">Home</a></li>
            <li><a asp-controller="AboutMe" asp-action="Index">About Me</a></li>
            <li><a asp-controller="Markets" asp-action="Index">Markets</a></li>
            <li><a asp-controller="Account" asp-action="Login">Login</a></li>
            <li><a asp-controller="Account" asp-action="Register">Register</a></li>
            <li><a asp-controller="Contact" asp-action="Index">Contact</a></li>
        </ul>
    </div>

    <!-- Cart Content -->
    <div class="cart-container">
        <h2>Your Cart</h2>

        @if (!Model.Any())
        {
            <p class="empty">Your cart is empty.</p>
        }
        else
        {
            <table class="cart-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Qty</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                <img src="@(item.ImageData != null ? $"data:{item.ContentType};base64,{Convert.ToBase64String(item.ImageData)}" : "/img/placeholder.png")"
                                     alt="@item.ProductName"
                                     style="width:80px;height:auto;border-radius:6px;" />
                            </td>
                            <td>@item.ProductName</td>
                            <td>@item.Price.ToString("C")</td>
                            <td>@item.Quantity</td>
                            <td>@(item.Price * item.Quantity).ToString("C")</td>
                            <td>
                                <a asp-controller="Cart" asp-action="Remove" asp-route-id="@item.ProductId"
                                   class="btn btn-danger btn-sm">Remove</a>
                            </td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" style="text-align:right; font-weight:bold;">Grand Total:</td>
                        <td>@grandTotal.ToString("C")</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>

            <a asp-controller="Checkout" asp-action="Index" class="btn btn-success mt-3">Proceed to Checkout</a>
        }
    </div>
</div>
